{"componentChunkName":"component---src-templates-post-jsx","path":"/js/functional-programming/generator-lazy-function/","result":{"data":{"site":{"siteMetadata":{"title":"kumas.blog"}},"markdownRemark":{"id":"a45e0939-9998-524f-a7a7-dbadfbf5302f","excerpt":"지연 평가란? 컴퓨터 프로그래밍에서 느긋한 계산법(Lazy evaluation)은 계산의 결과 값이 필요할 때까지 계산을 늦추는 기법이다.  지연 평가를 이용하면, 불필요한 계산을 하지 않게 되어 성능상의 이점이 있으며, 무한의 자료구조를 사용할 수 있습니다. ES6에서 추가된 이터레이터와 제너레이터를 이용하여 지연 평가되는 함수를 작성해 보겠습니다. 배…","html":"<h2>지연 평가란?</h2>\n<p>컴퓨터 프로그래밍에서 느긋한 계산법(Lazy evaluation)은 계산의 결과 값이 필요할 때까지 계산을 늦추는 기법이다. <code class=\"language-text\">위키피디아</code></p>\n<p>지연 평가를 이용하면, 불필요한 계산을 하지 않게 되어 성능상의 이점이 있으며, 무한의 자료구조를 사용할 수 있습니다. ES6에서 추가된 이터레이터와 제너레이터를 이용하여 지연 평가되는 함수를 작성해 보겠습니다.</p>\n<h2>배열을 리턴하는 range함수</h2>\n<p>숫자를 받아 숫자만큼의 배열을 리턴하는 함수를 작성해 보겠습니다.</p>\n<h3>일반적인 range</h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">range</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">l</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">++</span>i <span class=\"token operator\">&lt;</span> l<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> list <span class=\"token operator\">=</span> <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [0, 1, 2, 3, 4]</span>\n<span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 11</span></code></pre></div>\n<h3>지연 평가를 가지는 L.range</h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token constant\">L</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">range</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">++</span>i <span class=\"token operator\">&lt;</span> l<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">yield</span> i<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> list <span class=\"token operator\">=</span> <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// L.range {&lt;suspended>}</span>\n<span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">,</span> list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 11</span></code></pre></div>\n<p>두 가지의 range함수를 작성해 보았습니다. 하나는 배열에 값을 담아 리턴해주는 일반적인 함수이며, 나머지 하나는 제너레이터를 이용한 range함수입니다. 두 함수로 reduce 한 값은 11로 모두 동일하게 보입니다. 하지만 내부적으로 처리되는 방식은 다른데요, 일반적인 range 함수는 호출되는 즉시 배열 값을 리턴 하지만, 제너레이터를 이용한 L.range함수는 이터레이터 값을 리턴합니다.</p>\n<h2>입력된 길이 만큼 리턴하는 take</h2>\n<p>이번에는 배열의 길이와 배열을 전달하면 입력된 길이만큼 배열을 잘라서 리턴하는 take함수를 작성해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">take</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">l<span class=\"token punctuation\">,</span> iter</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> a <span class=\"token keyword\">of</span> iter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> l<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>take와 range를 이용한 지연 평가</h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [0, 1, 2, 3, 4]</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [0, 1, 2, 3, 4]</span></code></pre></div>\n<p>take 함수를 이용하여 range와 L.range에 적용해 보면 잘 작동하는 것을 확인할 수 있습니다.\n하지만 둘의 내부적으로 작동하는 방식은 다릅니다. range함수는 요청을 받는 즉시 [0, 1, 2, 3…99]의 배열을 완성시켜 take 함수에 전달을 하지만 L.range 즉시 처리하지 않고 이터레이터 값을 전달을 합니다. 그렇게 전달받은 값을 take의 for of에서 하나식 결괏값을 호출하며 진행을 하게 되고, 결과적으로 take의 요청 값인 5번만 range값을 진행하게 됩니다.</p>\n<h2>지연 평가를 가지는 L.map, L.filter</h2>\n<p>같은 방식으로 이전에 만든 map과 filter 함수도 지연 평가를 가지도록 함수를 재구성해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> iter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> a <span class=\"token keyword\">of</span> iter<span class=\"token punctuation\">)</span> <span class=\"token keyword\">yield</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">filter</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> iter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> a <span class=\"token keyword\">of</span> iter<span class=\"token punctuation\">)</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">f</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">yield</span> a<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>L.map과 L.filter는 제너레이터를 이용하여 지연성을 가지며 리턴되는 값은 결괏값이 아닌 이터레이터 값을 반환합니다.</p>\n<h2>range, map, filter, take, reduce 중첩사용</h2>\n<p>지금까지 만든 지연 평가되는 함수들을 중첩으로 사용해 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">go</span><span class=\"token punctuation\">(</span>\n  <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span> <span class=\"token operator\">=></span> n <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span> <span class=\"token operator\">=></span> n <span class=\"token operator\">%</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">go</span><span class=\"token punctuation\">(</span>\n  <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span> <span class=\"token operator\">=></span> n <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">L</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span> <span class=\"token operator\">=></span> n <span class=\"token operator\">%</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>두 개의 함수의 결괏값은 같지만 진행되는 방식은 다릅니다. 일반적인 range, map, filter 함수는 호출 즉시 값을 만들어 전달을 하지만 지연 평가되는 함수들은 값을 전달하지 않고 호출할 수 있는 이터레이터 값을 전달하며 계산을 미뤄줍니다.\nL.range, L.map, L.filter에서 계산을 진행하지 않고, take 함수까지 도착하게 되면 그제야 계산을 시작하게 됩니다. take 함수에서 for of을 진행할 때 이제 iter에 있는 이터레이터 값을 호출하여 L.filter에서 값을 요청합니다. 그리고 L.filter에서도 이터레이터 값을 호출하여 L.map으로 요청하고 반복해서 L.range까지 요청하게 됩니다. L.range에서 값을 계산한 뒤 다시 map, filter, take 순으로 전달하게 됩니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/2a91da5e3c647323d09c64f112d0192d/56272/01.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 51.764705882352935%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRUlEQVQoz02Sy66CUAxFz///lyFMnDEjBgUkKqLIQwShN6vJNrcJabtP35swjqM9n09r29amabJhGAxM+Ofzcbzve9d1XduyLL84MHKxX6+Xhfv9bmVZ2vF4tPf77fbpdPJEsKZp7Hq9WlVVdrlc7HA4/AY4n89euCgKf7vdbhZ4WNfV5nn2Dggaf9s2ezwerpm06zp/RzOZYpXPFoFgDDoh+AgrkCgfUVO0Yv/nYwc6syofthIpCKZJmEI3Q6uR8sHIC1TGAMTm4HokGBuMQvj6wL/fr+fga/rAQff7vUVR5EeGFAhJksTiOHYfQiAPQna7nWtwMIqlaerEOCkcnU6sBEGsgtb6MMo7E3ErBK21RRQxPqEMptLN+OiW57ljWp/kLMt+DXV7pmNaJ0XV6UgQ/5wKMwk2pxBpFEXzxr8nAtkQ+QMI9wHngB7UJQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='01' title='01' src='/static/2a91da5e3c647323d09c64f112d0192d/56272/01.png' srcset='/static/2a91da5e3c647323d09c64f112d0192d/e7570/01.png 170w,\n/static/2a91da5e3c647323d09c64f112d0192d/f46e7/01.png 340w,\n/static/2a91da5e3c647323d09c64f112d0192d/56272/01.png 501w' sizes='(max-width: 501px) 100vw, 501px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>값이 필요할 때에만 이터레이터를 호출하여 값을 계산하기 때문에 take 함수로 인해 값이 2개가 리턴되면 계산이 종료되게 됩니다. 따라서 모든 값을 계산하여 전달하는 일반적인 함수와 다르게 필요한 만큼만 계산해주는 지연 평가는 성능상에 이점이 있습니다.</p>\n<h2>참고</h2>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/functional-es6\">함수형 프로그래밍과 JavaScript ES6+</a></li>\n</ul>","frontmatter":{"title":"👀 제너레이터를 이용하여 함수의 지연평가","date":"October 05, 2021","update":null,"tags":["javascript","functional"],"series":"함수형 프로그래밍과 JavaScript ES6"},"fields":{"slug":"/js/functional-programming/generator-lazy-function/","readingTime":{"minutes":6.25}}},"seriesList":{"edges":[{"node":{"id":"ddcb5561-8c83-5451-b61f-03fcfadff802","fields":{"slug":"/js/functional-programming/iterator-function/"},"frontmatter":{"title":"✨️ 이터레이터를 이용한 높은 다형성을 가진 함수"}}},{"node":{"id":"a45e0939-9998-524f-a7a7-dbadfbf5302f","fields":{"slug":"/js/functional-programming/generator-lazy-function/"},"frontmatter":{"title":"👀 제너레이터를 이용하여 함수의 지연평가"}}},{"node":{"id":"e60e56c2-f80a-541d-adc6-05e64b202bfe","fields":{"slug":"/js/functional-programming/async-function/"},"frontmatter":{"title":"🙆 비동기 상황에서 잘 작동하는 함수"}}},{"node":{"id":"3211077e-4f16-5cf4-b89b-52741bcfbd8c","fields":{"slug":"/js/functional-programming/concurrency-function/"},"frontmatter":{"title":"✨ 지연된 평가를 병렬적으로 평가하기"}}}]},"previous":{"fields":{"slug":"/etc/vscode-vim/"},"frontmatter":{"title":"🕵️ VSCode에서 vim 설치 및 IM 세팅하기"}},"next":{"fields":{"slug":"/js/async-promise/"},"frontmatter":{"title":"💥 비동기를 값으로 다루는 Promise"}}},"pageContext":{"id":"a45e0939-9998-524f-a7a7-dbadfbf5302f","series":"함수형 프로그래밍과 JavaScript ES6","previousPostId":"4e2356c9-d9c6-5cf5-845e-0245d62fe8ce","nextPostId":"54eb89e7-6b88-57fa-a7a6-187627f33e8f"}},"staticQueryHashes":[]}